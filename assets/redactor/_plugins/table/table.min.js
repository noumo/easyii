!function(e){e.add("plugin","table",{translations:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(e){this.app=e,this.lang=e.lang,this.opts=e.opts,this.caret=e.caret,this.editor=e.editor,this.toolbar=e.toolbar,this.component=e.component,this.inspector=e.inspector,this.insertion=e.insertion,this.selection=e.selection},ondropdown:{table:{observe:function(e){this._observeDropdown(e)}}},onbottomclick:function(){this.insertion.insertToEnd(this.editor.getLastNode(),"table")},start:function(){var e={observe:"table","insert-table":{title:this.lang.get("insert-table"),api:"plugin.table.insert"},"insert-row-above":{title:this.lang.get("insert-row-above"),classname:"redactor-table-item-observable",api:"plugin.table.addRowAbove"},"insert-row-below":{title:this.lang.get("insert-row-below"),classname:"redactor-table-item-observable",api:"plugin.table.addRowBelow"},"insert-column-left":{title:this.lang.get("insert-column-left"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnLeft"},"insert-column-right":{title:this.lang.get("insert-column-right"),classname:"redactor-table-item-observable",api:"plugin.table.addColumnRight"},"add-head":{title:this.lang.get("add-head"),classname:"redactor-table-item-observable",api:"plugin.table.addHead"},"delete-head":{title:this.lang.get("delete-head"),classname:"redactor-table-item-observable",api:"plugin.table.deleteHead"},"delete-column":{title:this.lang.get("delete-column"),classname:"redactor-table-item-observable",api:"plugin.table.deleteColumn"},"delete-row":{title:this.lang.get("delete-row"),classname:"redactor-table-item-observable",api:"plugin.table.deleteRow"},"delete-table":{title:this.lang.get("delete-table"),classname:"redactor-table-item-observable",api:"plugin.table.deleteTable"}},t={title:this.lang.get("table")},n=this.toolbar.addButtonBefore("link","table",t);n.setIcon('<i class="re-icon-table"></i>'),n.setDropdown(e)},insert:function(){for(var e=this.component.create("table"),t=0;t<2;t++)e.addRow(3);e=this.insertion.insertHtml(e),this.caret.setStart(e)},addRowAbove:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),n=e.addRowTo(t,"before");this.caret.setStart(n)}},addRowBelow:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent(),n=e.addRowTo(t,"after");this.caret.setStart(n)}},addColumnLeft:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent();this.selection.save(),e.addColumnTo(t,"left"),this.selection.restore()}},addColumnRight:function(){var e=this._getComponent();if(e){var t=this.selection.getCurrent();this.selection.save(),e.addColumnTo(t,"right"),this.selection.restore()}},addHead:function(){var e=this._getComponent();e&&(this.selection.save(),e.addHead(),this.selection.restore())},deleteHead:function(){var t=this._getComponent();if(t){var n=this.selection.getCurrent();0!==e.dom(n).closest("thead").length?(t.removeHead(),this.caret.setStart(t)):(this.selection.save(),t.removeHead(),this.selection.restore())}},deleteColumn:function(){var t=this._getComponent();if(t){var n=this.selection.getCurrent(),i=e.dom(n).closest("td, th"),o=i.nextElement().get(),a=i.prevElement().get();t.removeColumn(n),o?this.caret.setStart(o):a?this.caret.setEnd(a):this.deleteTable()}},deleteRow:function(){var t=this._getComponent();if(t){var n=this.selection.getCurrent(),i=e.dom(n).closest("tr"),o=i.nextElement().get(),a=i.prevElement().get();t.removeRow(n),o?this.caret.setStart(o):a?this.caret.setEnd(a):this.deleteTable()}},deleteTable:function(){var e=this._getTable();e&&this.component.remove(e)},_getTable:function(){var e=this.selection.getCurrent(),t=this.inspector.parse(e);if(t.isTable())return t.getTable()},_getComponent:function(){var e=this.selection.getCurrent(),t=this.inspector.parse(e);if(t.isTable()){var n=t.getTable();return this.component.create("table",n)}},_observeDropdown:function(e){var t=this._getTable(),n=e.getItemsByClass("redactor-table-item-observable"),i=e.getItem("insert-table");t?(this._observeItems(n,"enable"),i.disable()):(this._observeItems(n,"disable"),i.enable())},_observeItems:function(e,t){for(var n=0;n<e.length;n++)e[n][t]()}})}(Redactor),function(e){e.add("class","table.component",{mixins:["dom","component"],init:function(e,t){return this.app=e,t&&void 0!==t.cmnt?t:this._init(t)},addHead:function(){this.removeHead();var t=this.$element.find("tr").first().children("td, th").length,n=e.dom("<thead>"),i=this._buildRow(t,"<th>");n.append(i),this.$element.prepend(n)},addRow:function(e){var t=this._buildRow(e);return this.$element.append(t),t},addRowTo:function(e,t){return this._addRowTo(e,t)},addColumnTo:function(t,n){var i=e.dom(t),o=i.closest("tr"),a=i.closest("td, th"),r=0;o.find("td, th").each(function(e,t){e===a.get()&&(r=t)}),this.$element.find("tr").each(function(t){var i=e.dom(t).find("td, th").get(r),o=e.dom(i),a=o.clone();a.html(""),"right"===n?o.after(a):o.before(a)})},removeHead:function(){var e=this.$element.find("thead");0!==e.length&&e.remove()},removeRow:function(t){e.dom(t).closest("tr").remove()},removeColumn:function(t){var n=e.dom(t),i=n.closest("tr"),o=n.closest("td, th"),a=0;i.find("td, th").each(function(e,t){e===o.get()&&(a=t)}),this.$element.find("tr").each(function(t){var n=e.dom(t).find("td, th").get(a);e.dom(n).remove()})},_init:function(t){var n,i;if(void 0!==t){var o=e.dom(t),a=o.get(),r=o.closest("figure");0!==r.length?(n=r,i=r.find("table").get()):"TABLE"===a.tagName&&(i=a)}this._buildWrapper(n),this._buildElement(i),this._initWrapper()},_addRowTo:function(t,n){var i=e.dom(t).closest("tr");if(0!==i.length){var o=i.children("td, th").length,a=this._buildRow(o);return i[n](a),a}},_buildRow:function(t,n){n=n||"<td>";for(var i=e.dom("<tr>"),o=0;o<t;o++){var a=e.dom(n);a.attr("contenteditable",!0),i.append(a)}return i},_buildElement:function(t){t?this.$element=e.dom(t):(this.$element=e.dom("<table>"),this.append(this.$element))},_buildWrapper:function(e){e=e||"<figure>",this.parse(e)},_initWrapper:function(){this.addClass("redactor-component"),this.attr({"data-redactor-type":"table",tabindex:"-1",contenteditable:!1})}})}(Redactor);